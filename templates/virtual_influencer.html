{% extends "layout.html" %}

{% block extra_head %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
<link rel="stylesheet" href="{{ url_for('static', filename='css/virtual-influencer.css') }}">
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/virtual-influencer.js') }}"></script>
{% endblock %}

{% block content %}
<div class="virtual-influencer-page">
    <!-- Tab Navigation -->
    <ul class="nav nav-tabs mb-4" id="influencerTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="create-influencer-tab" data-bs-toggle="tab" data-bs-target="#create-influencer-pane" type="button" role="tab" aria-controls="create-influencer-pane" aria-selected="true">
                <i class="fas fa-magic"></i> Create your virtual influencer
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="create-video-tab" data-bs-toggle="tab" data-bs-target="#create-video-pane" type="button" role="tab" aria-controls="create-video-pane" aria-selected="false">
                <i class="fas fa-video"></i> Create your Image Generation
            </button>
        </li>
        
    </ul>
    <div class="tab-content" id="influencerTabsContent">
        <div class="tab-pane fade show active" id="create-influencer-pane" role="tabpanel" aria-labelledby="create-influencer-tab">
            <div class="card mb-4 animate__animated animate__fadeIn">
                <div class="card-body">
                    <h5 class="card-title"><i class="fas fa-magic"></i> Create Your Virtual Influencer</h5>
                    <p class="card-text">Design a custom virtual influencer that perfectly represents your brand's identity and values. Our AI-powered tools make it easy to create a unique digital personality.</p>
                    
                    <div class="row mt-4">
                        <div class="col-md-6">
                            <div class="feature-box mb-4">
                                <i class="fas fa-palette feature-icon-sm"></i>
                                <h6>Customizable Appearance</h6>
                                <p>Design every aspect of your influencer's look, from facial features to style preferences.</p>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="feature-box mb-4">
                                <i class="fas fa-fingerprint feature-icon-sm"></i>
                                <h6>Unique Personality</h6>
                                <p>Create a distinctive character with traits that resonate with your target audience.</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="text-center mt-3">
                        <button class="btn btn-primary btn-lg" data-bs-toggle="modal" data-bs-target="#createInfluencerModal">
                            <i class="fas fa-plus-circle"></i> Start Creating
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="tab-pane fade" id="create-video-pane" role="tabpanel" aria-labelledby="create-video-tab">
            <div class="card mb-4 animate__animated animate__fadeIn">
                <div class="card-body">
                    <h5 class="card-title"><i class="fas fa-video"></i> Image Generation</h5>
                    <p class="card-text">Create stunning promotional images featuring your virtual influencer and brand. Our AI technology combines your inputs to generate professional marketing visuals.</p>
                    
                    <form id="imageGenForm" enctype="multipart/form-data" class="mt-4">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="virtualImage" class="form-label">Virtual Influencer Image</label>
                                    <div class="custom-file-container">
                                        <input type="file" class="form-control" id="virtualImage" name="face_image" accept="image/*" required>
                                        <small class="form-text text-muted">Upload a clear portrait image of your virtual influencer</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="brandImage" class="form-label">Brand Image</label>
                                    <div class="custom-file-container">
                                        <input type="file" class="form-control" id="brandImage" name="brand_image" accept="image/*" required>
                                        <small class="form-text text-muted">Upload your brand logo or product image</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="brandName" class="form-label">Brand Name</label>
                            <input type="text" class="form-control" id="brandName" name="brand_name" placeholder="Enter your brand name..." required>
                        </div>
                        
                        <div class="mb-3">
                            <label for="imagePrompt" class="form-label">Image Prompt</label>
                            <textarea class="form-control" id="imagePrompt" name="prompt" rows="3" placeholder="Describe the scene, mood, and context for your promotional image..." required></textarea>
                            <small class="form-text text-muted">Be specific about the setting, clothing, pose, and how the product should be featured</small>
                        </div>
                        
                        <div class="text-center mt-4">
                            <button type="submit" class="btn btn-primary btn-lg">
                                <i class="fas fa-bolt"></i> Generate Image
                            </button>
                        </div>
                    </form>
                    
                    <div class="result-container mt-4 text-center">
                        <img id="resultImage" style="display:none; max-width:100%; border-radius:8px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);" />
                        <div id="loadingIndicator" style="display:none;">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <p class="mt-2">Generating your image... This may take a moment.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Creation Options -->
    <div class="creation-options mb-5 text-center">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-md-10">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title mb-4"><i class="fas fa-wand-magic-sparkles"></i> Choose Your Creation Method</h5>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="creation-option-card">
                                        <div class="icon-container">
                                            <i class="fas fa-magic"></i>
                                        </div>
                                        <h6>Fooocus AI</h6>
                                        <p>Advanced image generation with fine-tuned control over style and appearance</p>
                                        <button class="btn btn-success btn-lg mt-3" id="createVirtualInfluencerBtn">
                                            <i class="fas fa-magic"></i> Create with Fooocus
                                        </button>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="creation-option-card">
                                        <div class="icon-container">
                                            <i class="fas fa-robot"></i>
                                        </div>
                                        <h6>LLM AI</h6>
                                        <p>Text-based generation that creates influencers from your detailed descriptions</p>
                                        <button class="btn btn-info btn-lg mt-3" id="createVirtualInfluencerLLMBtn">
                                            <i class="fas fa-robot"></i> Create with LLM
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for LLM Virtual Influencer -->
    <div class="modal fade" id="llmInfluencerModal" tabindex="-1" aria-labelledby="llmInfluencerModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <form id="llmInfluencerForm">
                    <div class="modal-header">
                        <h5 class="modal-title" id="llmInfluencerModalLabel">Create Virtual Influencer with LLM</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-4">
                            <h6 class="mb-3">Describe Your Ideal Virtual Influencer</h6>
                            <p class="text-muted mb-3">Be specific about appearance, personality, style, and target audience. The more details you provide, the better the result.</p>
                            
                            <div class="form-floating mb-3">
                                <textarea class="form-control" id="llmPrompt" name="llmPrompt" style="height: 150px" placeholder="Enter a prompt for your virtual influencer..." required></textarea>
                                <label for="llmPrompt">Detailed Description</label>
                            </div>
                            
                            <div class="prompt-examples">
                                <p class="text-muted small">Example: "A 25-year-old female fitness influencer with athletic build, shoulder-length blonde hair with blue highlights, bright blue eyes, and a confident smile. She has a vibrant, motivational personality and specializes in home workouts and nutrition tips for busy professionals."</p>
                            </div>
                        </div>
                        
                        <div class="generation-options mb-4">
                            <h6 class="mb-3">Generation Options</h6>
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="highQuality" name="highQuality" checked>
                                        <label class="form-check-label" for="highQuality">High Quality Generation</label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="enhanceDetails" name="enhanceDetails" checked>
                                        <label class="form-check-label" for="enhanceDetails">Enhance Details</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div id="llmImageResult" class="text-center mt-4">
                            <!-- Generated image will appear here -->
                            <div class="placeholder-container" style="display: none;">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                                <p class="mt-2">Generating your virtual influencer...</p>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-wand-magic-sparkles me-2"></i> Generate Influencer
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Modal for Fooocus Virtual Influencer -->
    <div class="modal fade" id="createInfluencerModal" tabindex="-1" aria-labelledby="createInfluencerModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="createInfluencerModalLabel">Create Your Virtual Influencer with Fooocus</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <form id="foocusInfluencerForm">
                                <div class="mb-3">
                                    <label for="influencerName" class="form-label">Influencer Name</label>
                                    <input type="text" class="form-control" id="influencerName" name="influencerName" placeholder="Enter a name..." required>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="influencerPrompt" class="form-label">Appearance Description</label>
                                    <textarea class="form-control" id="influencerPrompt" name="influencerPrompt" rows="4" placeholder="Describe appearance details..." required></textarea>
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">Gender</label>
                                    <div class="d-flex">
                                        <div class="form-check me-3">
                                            <input class="form-check-input" type="radio" name="gender" id="genderFemale" value="female" checked>
                                            <label class="form-check-label" for="genderFemale">Female</label>
                                        </div>
                                        <div class="form-check me-3">
                                            <input class="form-check-input" type="radio" name="gender" id="genderMale" value="male">
                                            <label class="form-check-label" for="genderMale">Male</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="gender" id="genderNeutral" value="neutral">
                                            <label class="form-check-label" for="genderNeutral">Neutral</label>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="stylePreset" class="form-label">Style Preset</label>
                                    <select class="form-select" id="stylePreset" name="stylePreset">
                                        <option value="photorealistic">Photorealistic</option>
                                        <option value="anime">Anime</option>
                                        <option value="cartoon">Cartoon</option>
                                        <option value="digital-art">Digital Art</option>
                                        <option value="fantasy">Fantasy</option>
                                    </select>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="specialty" class="form-label">Specialty</label>
                                    <select class="form-select" id="specialty" name="specialty">
                                        <option value="Fashion & Lifestyle">Fashion & Lifestyle</option>
                                        <option value="Tech & Gadgets">Tech & Gadgets</option>
                                        <option value="Beauty & Cosmetics">Beauty & Cosmetics</option>
                                        <option value="Fitness & Health">Fitness & Health</option>
                                        <option value="Travel & Adventure">Travel & Adventure</option>
                                        <option value="Food & Cooking">Food & Cooking</option>
                                        <option value="Gaming">Gaming</option>
                                        <option value="Art & Design">Art & Design</option>
                                    </select>
                                </div>
                            </form>
                        </div>
                        <div class="col-md-6">
                            <div class="generation-preview">
                                <h6 class="mb-3">Preview</h6>
                                <div class="preview-container text-center p-3 border rounded">
                                    <div id="previewPlaceholder">
                                        <i class="fas fa-user-circle fa-5x text-muted mb-3"></i>
                                        <p class="text-muted">Your virtual influencer preview will appear here</p>
                                    </div>
                                    <img id="previewImage" class="img-fluid rounded" style="display: none; max-height: 300px;">
                                </div>
                                
                                <div class="generation-options mt-4">
                                    <h6 class="mb-3">Advanced Options</h6>
                                    <div class="mb-3">
                                        <label for="qualityLevel" class="form-label">Quality Level</label>
                                        <input type="range" class="form-range" min="1" max="5" value="3" id="qualityLevel">
                                        <div class="d-flex justify-content-between">
                                            <small>Draft</small>
                                            <small>Standard</small>
                                            <small>High</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="generateInfluencerBtn">
                        <i class="fas fa-magic me-2"></i> Generate Influencer
                    </button>
                </div>
            </div>
        </div>
    </div>
    <div class="section-header animate__animated animate__fadeIn">
        <h1 class="mb-4">Rent a Virtual Influencer</h1>
        <p class="lead">Virtual influencers are computer-generated characters that can represent your brand across social media. They offer unique benefits over traditional influencers, including creative flexibility and 24/7 availability.</p>
    </div>

    <div class="benefits-section mb-5 animate__animated animate__fadeIn">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title mb-4">Why Choose a Virtual Influencer?</h5>
                <div class="row">
                    <div class="col-md-4 benefits-item">
                        <div class="benefit-icon-container">
                            <i class="fas fa-clock feature-icon"></i>
                        </div>
                        <h6>Always Available</h6>
                        <p>Virtual influencers don't need breaks and can engage with your audience around the clock.</p>
                    </div>
                    <div class="col-md-4 benefits-item">
                        <div class="benefit-icon-container">
                            <i class="fas fa-paint-brush feature-icon"></i>
                        </div>
                        <h6>Full Creative Control</h6>
                        <p>Shape every aspect of your influencer's personality, appearance, and messaging.</p>
                    </div>
                    <div class="col-md-4 benefits-item">
                        <div class="benefit-icon-container">
                            <i class="fas fa-chart-line feature-icon"></i>
                        </div>
                        <h6>Measurable Results</h6>
                        <p>Detailed analytics on engagement, reach, and conversion metrics for your campaigns.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="influencers-section mb-5 animate__animated animate__fadeIn">
        <div class="section-header">
            <h2 class="mb-4">Available Virtual Influencers</h2>
            <p class="text-muted mb-4">Browse our catalog of pre-designed virtual influencers ready to represent your brand</p>
        </div>
        
        <div class="row">
            {% for influencer in influencers %}
            <div class="col-lg-4 col-md-6 mb-4">
                <div class="card h-100 influencer-card">
                    <div class="card-img-wrapper">
                        {% if influencer.image_url %}
                        <img src="{{ influencer.image_url }}" class="card-img-top" alt="{{ influencer.name }}" style="height: 200px; object-fit: cover;">
                        {% else %}
                        <div class="default-avatar-placeholder" style="height: 200px; background: linear-gradient(45deg, #667eea, #764ba2); color: white; display: flex; justify-content: center; align-items: center; font-size: 3rem; font-weight: bold;">
                            {{ influencer.name[0].upper() if influencer.name else '?' }}
                        </div>
                        {% endif %}
                        <div class="overlay">
                            <span class="followers"><i class="fas fa-users"></i> {% if influencer.followers is defined %}{{ '{:,}'.format(influencer.followers) }}{% else %}N/A{% endif %}</span>
                            <span class="engagement"><i class="fas fa-heart"></i> {{ influencer.engagement_rate }}%</span>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="influencer-badge">{{ influencer.specialty }}</div>
                        <h5 class="card-title">{{ influencer.name }}</h5>
                        <p class="card-text">{{ influencer.description }}</p>
                        <div class="influencer-stats">
                            <div class="stat-item">
                                <i class="fas fa-users"></i>
                                <span>{% if influencer.followers is defined %}{{ '{:,}'.format(influencer.followers) }}{% else %}N/A{% endif %} followers</span>
                            </div>
                            <div class="stat-item">
                                <i class="fas fa-heart"></i>
                                <span>{{ influencer.engagement_rate }}% engagement</span>
                            </div>
                        </div>
                        <div class="pricing">
                            <span class="price">${{ '{:,}'.format(influencer.daily_rate) }}</span>
                            <span class="period">per day</span>
                        </div>
                    </div>
                    <div class="card-footer">
                        <button class="btn btn-primary rent-btn" data-influencer-id="{{ influencer.id }}">
                            <i class="fas fa-shopping-cart me-2"></i> Rent Now
                        </button>
                        <button class="btn btn-outline-secondary details-btn" data-influencer-id="{{ influencer.id }}">
                            <i class="fas fa-info-circle me-2"></i> Details
                        </button>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <div class="how-it-works-section mb-5 animate__animated animate__fadeIn">
        <div class="section-header">
            <h2 class="mb-4">How It Works</h2>
            <p class="text-muted mb-4">Our streamlined process makes it easy to launch your virtual influencer campaign</p>
        </div>
        
        <div class="process-timeline">
            <div class="row">
                <div class="col-md-3">
                    <div class="step-card">
                        <div class="step-number">1</div>
                        <div class="step-icon">
                            <i class="fas fa-search"></i>
                        </div>
                        <h5>Choose Your Influencer</h5>
                        <p>Browse our catalog and select the virtual influencer that best aligns with your brand identity and target audience.</p>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="step-card">
                        <div class="step-number">2</div>
                        <div class="step-icon">
                            <i class="fas fa-pencil-alt"></i>
                        </div>
                        <h5>Customize Your Campaign</h5>
                        <p>Define your campaign goals, messaging strategy, and creative direction with our expert team.</p>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="step-card">
                        <div class="step-number">3</div>
                        <div class="step-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <h5>Review & Approve</h5>
                        <p>Our team creates content for your approval before publishing, ensuring perfect alignment with your vision.</p>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="step-card">
                        <div class="step-number">4</div>
                        <div class="step-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <h5>Track Performance</h5>
                        <p>Access real-time analytics through our dashboard to measure your campaign's success and ROI.</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Preview Panel Section -->
        <div class="preview-section mb-5 animate__animated animate__fadeIn">
            <div class="section-header text-center">
                <h2 class="mb-4">Campaign Preview</h2>
                <p class="text-muted mb-4">See how your virtual influencer will look in action before starting your campaign</p>
            </div>
            
            <div class="row">
                <div class="col-lg-8 mx-auto">
                    <div class="preview-panel">
                        <div class="preview-header">
                            <div class="preview-tabs">
                                <button class="preview-tab active" data-platform="instagram">
                                    <i class="fab fa-instagram"></i> Instagram
                                </button>
                                <button class="preview-tab" data-platform="tiktok">
                                    <i class="fab fa-tiktok"></i> TikTok
                                </button>
                                <button class="preview-tab" data-platform="youtube">
                                    <i class="fab fa-youtube"></i> YouTube
                                </button>
                            </div>
                        </div>
                        
                        <div class="preview-content">
                            <!-- Instagram Preview -->
                            <div class="platform-preview active" id="instagram-preview">
                                <div class="social-post-mockup">
                                    <div class="post-header">
                                        <div class="post-avatar">
                                            <img src="https://images.unsplash.com/photo-1494790108755-2616b6b29d85?w=50&h=50&fit=crop&crop=face" alt="Ava" id="preview-avatar">
                                        </div>
                                        <div class="post-info">
                                            <h6 id="preview-username">@ava_virtual</h6>
                                            <small class="text-muted">Sponsored</small>
                                        </div>
                                        <div class="post-options">
                                            <i class="fas fa-ellipsis-v"></i>
                                        </div>
                                    </div>
                                    <div class="post-image">
                                        <img src="https://images.unsplash.com/photo-1441986300917-64674bd600d8?w=400&h=400&fit=crop" alt="Product showcase" id="preview-content-image">
                                    </div>
                                    <div class="post-actions">
                                        <div class="action-buttons">
                                            <i class="far fa-heart"></i>
                                            <i class="far fa-comment"></i>
                                            <i class="far fa-paper-plane"></i>
                                        </div>
                                        <div class="bookmark">
                                            <i class="far fa-bookmark"></i>
                                        </div>
                                    </div>
                                    <div class="post-stats">
                                        <strong>1,247 likes</strong>
                                    </div>
                                    <div class="post-caption">
                                        <strong id="preview-handle">ava_virtual</strong> 
                                        <span id="preview-caption">Loving this amazing product! Check it out 🔥 #sponsored #fashion #lifestyle</span>
                                    </div>
                                    <div class="post-comments">
                                        <small class="text-muted">View all 89 comments</small>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- TikTok Preview -->
                            <div class="platform-preview" id="tiktok-preview">
                                <div class="tiktok-mockup">
                                    <div class="tiktok-video">
                                        <img src="https://images.unsplash.com/photo-1611162617474-5b21e879e113?w=300&h=400&fit=crop" alt="TikTok content" class="tiktok-thumbnail">
                                        <div class="tiktok-overlay">
                                            <div class="play-button">
                                                <i class="fas fa-play"></i>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="tiktok-info">
                                        <div class="tiktok-description">
                                            <p><span id="tiktok-username">@ava_virtual</span></p>
                                            <p id="tiktok-caption">Amazing product review! 🔥 #productreview #sponsored</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- YouTube Preview -->
                            <div class="platform-preview" id="youtube-preview">
                                <div class="youtube-mockup">
                                    <div class="youtube-video">
                                        <img src="https://images.unsplash.com/photo-1611224923853-80b023f02d71?w=400&h=225&fit=crop" alt="YouTube thumbnail" class="youtube-thumbnail">
                                        <div class="youtube-overlay">
                                            <div class="youtube-play">
                                                <i class="fab fa-youtube"></i>
                                            </div>
                                            <div class="video-duration">8:24</div>
                                        </div>
                                    </div>
                                    <div class="youtube-info">
                                        <div class="youtube-title">
                                            <h6 id="youtube-title">Product Review: Why This Changed Everything!</h6>
                                        </div>
                                        <div class="youtube-meta">
                                            <span id="youtube-channel">Ava Virtual</span> • 847K views • 2 days ago
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="preview-footer">
                            <div class="preview-stats">
                                <div class="stat-item">
                                    <strong>1.2M+</strong>
                                    <span>Potential Reach</span>
                                </div>
                                <div class="stat-item">
                                    <strong>8.5%</strong>
                                    <span>Avg Engagement</span>
                                </div>
                                <div class="stat-item">
                                    <strong>$4.20</strong>
                                    <span>Cost per Engagement</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="text-center mt-5">
            <a href="#" class="btn btn-lg btn-primary">
                <i class="fas fa-rocket me-2"></i> Start Your Campaign
            </a>
        </div>
    </div>

    <!-- Hidden Modal for Booking -->
    <div class="modal fade" id="bookingModal" tabindex="-1" aria-labelledby="bookingModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="bookingModalLabel" style="color: var(--text-color);">Rent a Virtual Influencer</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="bookingForm">
                        <input type="hidden" id="influencerId" name="influencerId">
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="startDate" class="form-label" style="color: var(--text-color);">Start Date</label>
                                <input type="date" class="form-control" id="startDate" name="startDate" required>
                            </div>
                            <div class="col-md-6">
                                <label for="duration" class="form-label" style="color: var(--text-color);">Duration (Days)</label>
                                <input type="number" class="form-control" id="duration" name="duration" min="1" max="90" value="7" required>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="campaignName" class="form-label" style="color: var(--text-color);">Campaign Name</label>
                            <input type="text" class="form-control" id="campaignName" name="campaignName" required>
                        </div>
                        <div class="mb-3">
                            <label for="campaignObjectives" class="form-label" style="color: var(--text-color);">Campaign Objectives</label>
                            <select class="form-select" id="campaignObjectives" name="campaignObjectives" required>
                                <option value="">Select an objective...</option>
                                <option value="brand_awareness">Brand Awareness</option>
                                <option value="engagement">Engagement</option>
                                <option value="conversions">Conversions</option>
                                <option value="product_launch">Product Launch</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="campaignDetails" class="form-label" style="color: var(--text-color);">Campaign Details</label>
                            <textarea class="form-control" id="campaignDetails" name="campaignDetails" rows="3" required></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="platforms" class="form-label" style="color: var(--text-color);">Platforms</label>
                            <div class="d-flex flex-wrap">
                                <div class="form-check me-3">
                                    <input class="form-check-input" type="checkbox" value="instagram" id="instagram" name="platforms">
                                    <label class="form-check-label" for="instagram">Instagram</label>
                                </div>
                                <div class="form-check me-3">
                                    <input class="form-check-input" type="checkbox" value="tiktok" id="tiktok" name="platforms">
                                    <label class="form-check-label" for="tiktok">TikTok</label>
                                </div>
                                <div class="form-check me-3">
                                    <input class="form-check-input" type="checkbox" value="twitter" id="twitter" name="platforms">
                                    <label class="form-check-label" for="twitter">Twitter</label>
                                </div>
                                <div class="form-check me-3">
                                    <input class="form-check-input" type="checkbox" value="youtube" id="youtube" name="platforms">
                                    <label class="form-check-label" for="youtube">YouTube</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="other" id="other" name="platforms">
                                    <label class="form-check-label" for="other">Other</label>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <div class="pricing-summary me-auto">
                        <span>Total: $<span id="totalPrice">0</span></span>
                    </div>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="confirmBooking">Confirm Booking</button>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .virtual-influencer-page {
        padding: 2rem 0;
    }
    
    .section-header {
        text-align: center;
        margin-bottom: 2rem;
    }
    
    .section-header h1, .section-header h2 {
        color: var(--text-color);
        font-weight: 700;
    }
    
    .section-header p {
        color: var(--secondary-text);
    }
    
    .feature-icon {
        font-size: 2.5rem;
        color: var(--primary-color);
        margin-bottom: 1rem;
    }
    
    .benefits-item {
        text-align: center;
        padding: 1rem;
    }
    
    .influencer-card {
        transition: transform 0.3s ease;
        border-radius: 10px;
        overflow: hidden;
    }
    
    .influencer-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(0,0,0,0.1);
    }
    
    .card-img-wrapper {
        position: relative;
        overflow: hidden;
        height: 250px;
    }
    
    .card-img-top {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }
    
    .overlay {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        background: linear-gradient(to top, rgba(0,0,0,0.7), transparent);
        padding: 1rem;
        color: white;
        display: flex;
        justify-content: space-between;
    }
    
    .pricing {
        display: flex;
        align-items: baseline;
        margin-top: 1rem;
    }
    
    .price {
        font-size: 1.5rem;
        font-weight: bold;
        color: #4e73df;
    }
    
    .period {
        font-size: 0.875rem;
        margin-left: 0.5rem;
        color: #6c757d;
    }
    
    .step-card {
        background-color: var(--card-bg);
        border-radius: 10px;
        padding: 2rem;
        text-align: center;
        height: 100%;
        position: relative;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        border: 1px solid var(--border-color);
    }
    
    .step-card h5 {
        color: var(--text-color);
        font-weight: 600;
        margin-bottom: 1rem;
    }
    
    .step-card p {
        color: var(--secondary-text);
    }
    
    .step-number {
        background-color: var(--primary-color);
        color: white;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        margin: 0 auto 1rem;
    }
    
    /* Preview Panel Styles */
    .preview-section {
        background: white;
        padding: 2rem 0;
        margin: 2rem 0;
        border-radius: 12px;
        border: 1px solid #e9ecef;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
    }
    
    .preview-section .section-header h2 {
        color: #2c3e50;
        font-size: 1.8rem;
        margin-bottom: 0.5rem;
    }
    
    .preview-section .section-header p {
        color: #6c757d;
        margin-bottom: 1.5rem;
    }
    
    .preview-panel {
        background: #f8f9fa;
        border-radius: 10px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        overflow: hidden;
        max-width: 600px;
        margin: 0 auto;
    }
    
    .preview-header {
        padding: 1rem;
        border-bottom: 1px solid #e9ecef;
        background: white;
    }
    
    .preview-tabs {
        display: flex;
        gap: 0.5rem;
        justify-content: center;
    }
    
    .preview-tab {
        padding: 0.5rem 1rem;
        border: none;
        background: #f8f9fa;
        border-radius: 6px;
        color: #6c757d;
        font-weight: 500;
        font-size: 0.85rem;
        transition: all 0.3s ease;
        cursor: pointer;
    }
    
    .preview-tab.active {
        background: #667eea;
        color: white;
    }
    
    .preview-tab:hover {
        background: #667eea;
        color: white;
    }
    
    .preview-content {
        padding: 1.5rem;
        min-height: 300px;
        background: white;
    }
    
    .platform-preview {
        display: none;
    }
    
    .platform-preview.active {
        display: block;
    }
    
    /* Instagram Post Mockup */
    .social-post-mockup {
        max-width: 320px;
        margin: 0 auto;
        border: 1px solid #dbdbdb;
        border-radius: 8px;
        background: white;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    
    .post-header {
        display: flex;
        align-items: center;
        padding: 0.75rem;
        gap: 0.5rem;
    }
    
    .post-avatar img {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        object-fit: cover;
    }
    
    .post-info h6 {
        margin: 0;
        font-weight: 600;
        font-size: 0.85rem;
    }
    
    .post-options {
        margin-left: auto;
        color: #8e8e8e;
        font-size: 0.8rem;
    }
    
    .post-image img {
        width: 100%;
        height: 280px;
        object-fit: cover;
    }
    
    .post-actions {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.5rem 0.75rem;
    }
    
    .action-buttons {
        display: flex;
        gap: 0.75rem;
    }
    
    .action-buttons i, .bookmark i {
        font-size: 1.2rem;
        color: #262626;
        cursor: pointer;
    }
    
    .post-stats, .post-caption, .post-comments {
        padding: 0 0.75rem 0.3rem;
    }
    
    .post-stats {
        font-size: 0.8rem;
        color: #262626;
        font-weight: 600;
    }
    
    .post-caption {
        font-size: 0.8rem;
        line-height: 1.3;
    }
    
    .post-comments {
        font-size: 0.8rem;
        padding-bottom: 0.75rem;
        color: #8e8e8e;
    }
    
    /* TikTok Mockup */
    .tiktok-mockup {
        max-width: 250px;
        margin: 0 auto;
        background: #000;
        border-radius: 10px;
        overflow: hidden;
        position: relative;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }
    
    .tiktok-video {
        position: relative;
        height: 320px;
    }
    
    .tiktok-thumbnail {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }
    
    .tiktok-overlay {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
    }
    
    .play-button {
        width: 50px;
        height: 50px;
        background: rgba(255, 255, 255, 0.9);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #000;
        font-size: 1.2rem;
    }
    
    .tiktok-info {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        background: linear-gradient(transparent, rgba(0, 0, 0, 0.8));
        padding: 1.5rem 0.75rem 0.75rem;
        color: white;
    }
    
    .tiktok-description p {
        margin: 0;
        font-size: 0.8rem;
    }
    
    /* YouTube Mockup */
    .youtube-mockup {
        max-width: 320px;
        margin: 0 auto;
    }
    
    .youtube-video {
        position: relative;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    
    .youtube-thumbnail {
        width: 100%;
        height: 180px;
        object-fit: cover;
    }
    
    .youtube-overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.3);
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .youtube-play {
        font-size: 2.5rem;
        color: #ff0000;
        background: rgba(255, 255, 255, 0.9);
        width: 60px;
        height: 60px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .video-duration {
        position: absolute;
        bottom: 6px;
        right: 6px;
        background: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 2px 4px;
        border-radius: 3px;
        font-size: 0.7rem;
    }
    
    .youtube-info {
        padding: 0.75rem 0;
    }
    
    .youtube-title h6 {
        margin: 0 0 0.3rem;
        font-weight: 600;
        line-height: 1.3;
        font-size: 0.9rem;
    }
    
    .youtube-meta {
        font-size: 0.75rem;
        color: #606060;
    }
    
    .preview-footer {
        background: #f8f9fa;
        padding: 1rem;
        border-top: 1px solid #e9ecef;
    }
    
    .preview-stats {
        display: flex;
        justify-content: space-around;
        text-align: center;
    }
    
    .preview-stats .stat-item strong {
        display: block;
        font-size: 1rem;
        color: #667eea;
        margin-bottom: 0.2rem;
        font-weight: 600;
    }
    
    .preview-stats .stat-item span {
        color: #6c757d;
        font-size: 0.8rem;
    }
</style>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
$(document).ready(function() {
  $('#imageGenForm').on('submit', function(event) {
    event.preventDefault();
    var formData = new FormData(this);
    $.ajax({
      url: '/generate_image',
      type: 'POST',
      data: formData,
      processData: false,
      contentType: false,
      success: function(response) {
        if (response.image_url) {
          $('#resultImage').attr('src', response.image_url).show();
        } else if (response.image_base64) {
          $('#resultImage').attr('src', 'data:image/png;base64,' + response.image_base64).show();
        } else if (response.error) {
          alert('Error: ' + response.error);
        } else {
          alert('Unexpected response from server.');
        }
      },
      error: function(xhr) {
        alert('Error generating image.');
      }
    });
  });
});
</script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Rent button event handlers
        const rentButtons = document.querySelectorAll('.rent-btn');
        const detailsButtons = document.querySelectorAll('.details-btn');
        const bookingModal = new bootstrap.Modal(document.getElementById('bookingModal'));
        const influencersData = {{ influencers|tojson|safe }};
        
        rentButtons.forEach(button => {
            button.addEventListener('click', function() {
                const influencerId = this.getAttribute('data-influencer-id');
                document.getElementById('influencerId').value = influencerId;
                
                // Find the influencer in our data
                const influencer = influencersData.find(inf => inf.id === influencerId);
                if (influencer) {
                    document.getElementById('bookingModalLabel').textContent = `Rent ${influencer.name}`;
                    updateTotalPrice(influencer.daily_rate, 7); // Default 7 days
                }
                
                bookingModal.show();
            });
        });
        
        // Duration change event handler
        document.getElementById('duration').addEventListener('change', function() {
            const influencerId = document.getElementById('influencerId').value;
            const influencer = influencersData.find(inf => inf.id === influencerId);
            if (influencer) {
                updateTotalPrice(influencer.daily_rate, this.value);
            }
        });
        
        function updateTotalPrice(dailyRate, days) {
            const totalPrice = dailyRate * days;
            document.getElementById('totalPrice').textContent = totalPrice.toLocaleString();
        }
        
        // Form submission
        document.getElementById('confirmBooking').addEventListener('click', function() {
            const form = document.getElementById('bookingForm');
            if (form.checkValidity()) {
                // In a real application, you would submit this to the server
                alert('Booking confirmed! Our team will contact you shortly with next steps.');
                bookingModal.hide();
            } else {
                form.reportValidity();
            }
        });
    });

     // LLM: Create Virtual Influencer Modal Logic
     document.getElementById('createVirtualInfluencerLLMBtn').addEventListener('click', function() {
        var llmModal = new bootstrap.Modal(document.getElementById('llmInfluencerModal'));
        document.getElementById('llmPrompt').value = '';
        document.getElementById('llmImageResult').innerHTML = '';
        llmModal.show();
    });

    document.getElementById('llmInfluencerForm').addEventListener('submit', function(event) {
        event.preventDefault();
        var prompt = document.getElementById('llmPrompt').value;
        var resultDiv = document.getElementById('llmImageResult');
        resultDiv.innerHTML = '<div>Generating image...</div>';
        fetch('/generate_llm_influencer', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ prompt: prompt })
        })
        .then(response => response.json())
        .then(data => {
            if (data.image_url) {
                resultDiv.innerHTML = '<img src="' + data.image_url + '" style="max-width:100%;">';
            } else if (data.image_base64) {
                resultDiv.innerHTML = '<img src="data:image/png;base64,' + data.image_base64 + '" style="max-width:100%;">';
            } else if (data.error) {
                resultDiv.innerHTML = '<div class="text-danger">Error: ' + data.error + '</div>';
            } else {
                resultDiv.innerHTML = '<div class="text-danger">Unexpected response from server.</div>';
            }
        })
        .catch(() => {
            resultDiv.innerHTML = '<div class="text-danger">Error generating image.</div>';
        });
    });


    // Fooocus: Create Virtual Influencer Modal Logic
    document.getElementById('createVirtualInfluencerBtn').addEventListener('click', function() {
        window.open('http://localhost:7860/', '_blank'); // Opens Fooocus UI in a new tab
    });

    // Preview Panel Functionality
    const previewTabs = document.querySelectorAll('.preview-tab');
    const platformPreviews = document.querySelectorAll('.platform-preview');
    
    previewTabs.forEach(tab => {
        tab.addEventListener('click', function() {
            // Remove active class from all tabs and previews
            previewTabs.forEach(t => t.classList.remove('active'));
            platformPreviews.forEach(p => p.classList.remove('active'));
            
            // Add active class to clicked tab
            this.classList.add('active');
            
            // Show corresponding preview
            const platform = this.getAttribute('data-platform');
            document.getElementById(platform + '-preview').classList.add('active');
        });
    });
    
    // Update preview content based on selected influencer
    function updatePreviewContent(influencer) {
        // Update Instagram preview
        document.getElementById('preview-avatar').src = influencer.image_url;
        document.getElementById('preview-username').textContent = `@${influencer.name.toLowerCase()}_virtual`;
        document.getElementById('preview-handle').textContent = `${influencer.name.toLowerCase()}_virtual`;
        document.getElementById('preview-caption').textContent = `Loving this amazing product! Check it out 🔥 #sponsored #${influencer.specialty.toLowerCase().replace(' & ', ' #')}`;
        
        // Update TikTok preview
        document.getElementById('tiktok-username').textContent = `@${influencer.name.toLowerCase()}_virtual`;
        document.getElementById('tiktok-caption').textContent = `Amazing product review! 🔥 #productreview #sponsored #${influencer.specialty.toLowerCase().replace(' & ', '')}`;
        
        // Update YouTube preview
        document.getElementById('youtube-title').textContent = `${influencer.specialty} Review: Why This Changed Everything!`;
        document.getElementById('youtube-channel').textContent = `${influencer.name} Virtual`;
    }
    
    // Update preview when an influencer card is clicked
    document.querySelectorAll('.influencer-card').forEach(card => {
        card.addEventListener('click', function() {
            const influencerId = this.querySelector('.rent-btn').getAttribute('data-influencer-id');
            const influencer = influencersData.find(inf => inf.id === influencerId);
            if (influencer) {
                updatePreviewContent(influencer);
                // Scroll to preview section
                document.querySelector('.preview-section').scrollIntoView({ 
                    behavior: 'smooth' 
                });
            }
        });
    });
    
    // Initialize with first influencer
    if (influencersData && influencersData.length > 0) {
        updatePreviewContent(influencersData[0]);
    }

</script>
{% endblock %}
